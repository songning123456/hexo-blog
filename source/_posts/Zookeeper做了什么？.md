---
title: Zookeeper做了什么？
date: 2021-01-16 09:46:56
tags: [面试, ZooKeeper]
category: [面试, ZooKeeper]
---

# 命名服务(文件系统)

命名服务是指通过指定的名字来获取资源或者服务的地址，利用Zookeeper创建一个全局的路径，即是唯一的路径，这个路径就可以作为一个名字，指向集群中的集群，提供的服务的地址，或者一个远程的对象等等。

# 配置管理(文件系统、通知机制)

程序分布式的部署在不同的机器上，将程序的配置信息放在Zookeeper的znode下，当有配置发生改变时，也就是znode发生变化时，可以通过改变Zookeeper中某个目录节点的内容，利用watcher通知给各个客户端，从而更改配置。

# 集群管理(文件系统、通知机制)

所谓集群管理无在乎两点：是否有机器退出和加入、选举master。 

对于第一点，所有机器约定在父目录下创建临时目录节点，然后监听父目录节点的子节点变化消息。一旦有机器挂掉，该机器与Zookeeper的连接断开，其所创建的临时目录节点被删除，所有其他机器都收到通知：某个兄弟目录被删除，于是，所有人都知道它上船了。 

新机器加入也是类似，所有机器收到通知：新兄弟目录加入，highcount又有了，对于第二点，我们稍微改变一下，所有机器创建临时顺序编号目录节点，每次选取编号最小的机器作为master就好。

# 分布式锁(文件系统、通知机制)

有了Zookeeper的一致性文件系统，锁的问题变得容易。锁服务可以分为两类：一个是保持独占，另一个是控制时序。

对于第一类，我们将Zookeeper上的一个znode看作是一把锁，通过create znode的方式来实现。所有客户端都去创建/distribute_lock节点，最终成功创建的那个客户端也即拥有了这把锁。用完删除掉自己创建的distribute_lock节点就释放出锁。

对于第二类，/distribute_lock已经预先存在，所有客户端在它下面创建临时顺序编号目录节点，和选master一样，编号最小的获得锁，用完删除，依次方便。

