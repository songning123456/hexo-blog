---
title: 能聊聊你对CAS的理解以及它的底层原理吗？
date: 2021-01-15 11:08:16
tags: [面试, Java]
category: [面试, Java, 并发]
---

**内存值V，预期值A，要更新的新值B**

t1和t2线程都同时去访问同一变量V=56，所以他们会把主内存的值V完全拷贝一份到自己的工作内存空间，所以t1和t2线程的预期值都为V=56。假设t1在与t2线程竞争中线程t1能去更新变量的值，而其他线程都失败(失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次发起尝试)。t1线程去更新变量值改为B=57，然后写到内存中。此时对于t2来说，内存值变为了57，与预期值56不一致，就操作失败了(想改的值不再是原来的值)。

就是指当两者进行比较时，如果相等，则证明共享数据没有被修改，替换成新值，然后继续往下运行；如果不相等，说明共享数据已经被修改，放弃已经所做的操作，然后重新执行刚才的操作。容易看出CAS操作是基于共享数据不会被修改的假设，采用了类似于数据库的commit-retry的模式。当同步冲突出现的机会很少时，这种假设能带来较大的性能提升。

{% asset_img CAS.png %}