---
title: TCP粘包/拆包的原因及解决方法？
date: 2021-01-15 13:52:27
tags: [面试, 网络]
category: [面试, 网络]
---

# 拆包

* 应用程序写入数据大于TCP缓冲区剩余空间大小。
* 应用程序写入数据大于MSS(最大报文长度)，会发生拆包现象。

# 粘包

* 应用程序写入数据小于TCP缓冲区大小，TCP将多次写入缓冲区的数据一次发送出去。
* 接收数据端的应用层没有及时读取接收缓冲区中的数据。

# 解决办法

## 消息定长(FixedLengthFrameDecoder类)

发送端将每个数据包封装为固定长度(不够的可以通过补0填充)，这样接收端每次从接收缓冲区中读取固定长度的数据就自然而然的把每个数据包拆分开来。

## 将消息分为消息头和消息体(LengthFieldBasedFrameDecoder类)

发送端给每个数据包添加包首部，首部中应该至少包含数据包的长度，这样接收端在接收到数据后，通过读取包首部的长度字段，便知道每一个数据包的实际长度了。

## 包尾增加特殊字符分割

行分隔符类LineBasedFrameDecoder或自定义分隔符类DelimiterBasedFrameDecoder。